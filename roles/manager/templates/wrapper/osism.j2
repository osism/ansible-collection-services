#!/usr/bin/env bash

# DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN

if [ "$(id -u)" == "0" ]; then
   echo -e "WARNING: OSISM CLI should not be used as root user\n" 1>&2
fi

PARAMETERS=${PARAMETERS:-}

if [[ -t 0 && -t 1 && -t 2 ]]; then
    INTERACTIVE=${INTERACTIVE:-true}
else
    INTERACTIVE=${INTERACTIVE:-false}
fi

if [[ $INTERACTIVE == "true" ]]; then

    PARAMETERS="$PARAMETERS -it"

fi

# The update from the manager is done with osism-update-manager script as
# it cannot be done within a container as it is recreated during the update.
if [[ "$@" = *"update manager"* ]]; then
    shift
    shift
    exec /usr/local/bin/osism-update-manager "$@"
fi

# The update from the docker service on the manager is done with
# osism-update-docker script as it cannot be done within a container as it
# may be recreated during the update.
if [[ "$@" = *"update docker"* ]]; then
    shift
    shift
    exec /usr/local/bin/osism-update-docker "$@"
fi

if [[ -n "$OSISM_APPLY_RETRY" ]]; then
    PARAMETERS="$PARAMETERS --env OSISM_APPLY_RETRY=$OSISM_APPLY_RETRY"
fi

if [[ -n "$OSISM_RETRY" ]]; then
    PARAMETERS="$PARAMETERS --env OSISM_RETRY=$OSISM_RETRY"
fi

docker exec $PARAMETERS osismclient osism "$@"
