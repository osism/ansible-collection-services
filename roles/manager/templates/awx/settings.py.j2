###############################################################################
# AWX settings file
###############################################################################

import os


def read_secret(secret_name):
    try:
        f = open('/run/secrets/' + secret_name, 'r', encoding='utf-8')
    except EnvironmentError:
        return ''
    else:
        with f:
            return f.readline().strip()


###############################################################################
# GENERIC
###############################################################################

ADMINS = ()
SECRET_KEY = read_secret('TOWER_SECRET_KEY')
ALLOWED_HOSTS = ['*']


###############################################################################
# REDIS
###############################################################################

BROKER_URL = 'redis://redis:6379'
CHANNEL_LAYERS = {
   'default': {'BACKEND': 'channels_redis.core.RedisChannelLayer',
               'CONFIG': {
                   'hosts': ["redis://redis:6379/10"],
                   'capacity': 10000,
               }}
}

DJANGO_REDIS_IGNORE_EXCEPTIONS = True
CACHES = {
    'default': {
        'BACKEND': 'django_redis.cache.RedisCache',
        'LOCATION': 'redis://redis:6379',
        'OPTIONS': {
            'DB': 11
        }
    },
    'ephemeral': {
        'BACKEND': 'django.core.cache.backends.locmem.LocMemCache',
    }
}

###############################################################################
# OTHER
###############################################################################

{% for key, value in awx_configuration|dictsort -%}
{% if value is sameas false %}
{{ key }} = False
{% elif value is sameas true %}
{{ key }} = True
{% elif value is string %}
{{ key }} = '{{ value }}'
{% elif value is number %}
{{ key }} = {{ value }}
{% endif %}
{% endfor -%}
