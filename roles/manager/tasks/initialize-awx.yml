---
- name: Run awx-manage migrate command
  ansible.builtin.command: docker exec manager_awx_1 awx-manage migrate
  async: 1800
  poll: 0
  register: command_sleeper

- name: Wait for awx-manage migrate command to complete
  ansible.builtin.async_status:
    jid: "{{ command_sleeper.ansible_job_id }}"
  register: job_result
  until: job_result.finished
  retries: 60
  delay: 30

- name: Run create-admin-user.sh command
  ansible.builtin.command: docker exec manager_awx_1 /usr/local/bin/create-admin-user.sh
  async: 1800
  poll: 0
  register: command_sleeper

- name: Wait for create-admin-user.sh command to complete
  ansible.builtin.async_status:
    jid: "{{ command_sleeper.ansible_job_id }}"
  register: job_result
  until: job_result.finished
  retries: 60
  delay: 30

- name: Run provision-instance.sh command
  ansible.builtin.command: docker exec manager_awx_1 /usr/local/bin/provision-instance.sh
  async: 1800
  poll: 0
  register: command_sleeper

- name: Wait for provision-instance.sh command to complete
  ansible.builtin.async_status:
    jid: "{{ command_sleeper.ansible_job_id }}"
  register: job_result
  until: job_result.finished
  retries: 60
  delay: 30
