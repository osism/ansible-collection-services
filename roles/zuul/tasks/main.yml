---
# tasks file for zuul

# unfortunately zookeeper can only read certificates with group
# permissions. therefore the base directory can only be entered
# by the owner. the files in this directy will have read
# permissions for all others too.
- name: create base config directory
  ansible.builtin.file:
    state: directory
    path: "{{ base_conf_dir }}"
    owner: "{{ operator_user }}"
    group: "{{ operator_group }}"
    mode: 0744

- name: create component config directories
  ansible.builtin.file:
    state: directory
    path: "{{ item['value'] }}"
    owner: "{{ operator_user }}"
    group: "{{ operator_group }}"
    mode: 0744
  loop: "{{ component_conf_dirs |Â dict2items }}"

- name: include copy tasks
  ansible.builtin.include_tasks: copy_tasks.yml

- name: include template tasks
  ansible.builtin.include_tasks: template_tasks.yml

- name: include generation of certificates and keys
  ansible.builtin.include_tasks: generate_certs_and_keys.yml

- name: start zuul
  community.docker.docker_compose:
    project_src: "{{ base_conf_dir }}"
    project_name: zuul
