---
- name: Include config tasks
  ansible.builtin.include_tasks: config.yml
  tags: config

- name: Include create database tasks
  ansible.builtin.include_tasks: "create-database.yml"
  when: keycloak_galera_backend_enable|bool

- name: Include service tasks
  ansible.builtin.include_tasks: service.yml
  tags: service

# Test section #################################################################
- name: Debug Keycloak service
  become: true
  changed_when: false
  ansible.builtin.shell:
    cmd: |
      set -e; \
      systemctl status docker-compose@keycloak; \
      systemctl is-active docker-compose@keycloak; \
      journalctl -xe | grep docker-compose@keycloak; \
      docker ps -a; \
      docker container inspect keycloak
  args:
    executable: /bin/bash
