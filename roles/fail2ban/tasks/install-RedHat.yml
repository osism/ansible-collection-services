---
- name: Setup EPEL Repository and Update Package Cache
  become: true
  block:
    - name: Install EPEL repository
      ansible.builtin.dnf:
        name: epel-release
        state: present

    - name: Enable EPEL repository
      command:
        cmd: dnf config-manager --set-enabled epel

    - name: Update package cache after installing EPEL repo
      ansible.builtin.dnf:
        update_cache: true

- name: Install fail2ban package
  become: true
  ansible.builtin.dnf:
    name: "{{ fail2ban_package_name }}"
    state: present

- name: Ensure fail2ban service is enabled and started
  become: true
  ansible.builtin.systemd:
    name: fail2ban
    state: started
    enabled: yes
