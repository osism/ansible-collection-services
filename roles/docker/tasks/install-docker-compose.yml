---
- name: Get home directory of docker user
  ansible.builtin.shell: |
    set -o pipefail
    getent passwd {{ docker_user }} | cut -d: -f6
  args:
    executable: /bin/bash
  changed_when: false
  register: docker_home

- name: Create cli-plugins directory
  ansible.builtin.file:
    path: "{{ docker_home.stdout }}/.docker/cli-plugins"
    state: directory
    owner: "{{ docker_user }}"
    group: "{{ docker_group }}"
    mode: 0755

- name: Copy docker-compose cli plugin
  ansible.builtin.copy:
    src: "docker-compose-{{ docker_compose_version }}/docker-compose-linux-x86_64.bin"
    dest: "{{ docker_home.stdout }}/.docker/cli-plugins/docker-compose"
    owner: "{{ docker_user }}"
    group: "{{ docker_group }}"
    mode: 0755
